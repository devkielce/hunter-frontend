(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8383:function(e,t,r){Promise.resolve().then(r.bind(r,1523)),Promise.resolve().then(r.bind(r,49)),Promise.resolve().then(r.bind(r,7516)),Promise.resolve().then(r.bind(r,3170))},7516:function(e,t,r){"use strict";r.d(t,{ListingDashboard:function(){return p}});var a=r(7437),n=r(2265),l=r(3145);let s=[{value:"new",label:"Nowy"},{value:"contacted",label:"Skontaktowano"},{value:"viewed",label:"Obejrzano"},{value:"archived",label:"Zarchiwizowano"}],i={facebook:{label:"Facebook",color:"bg-blue-600",icon:"\uD83D\uDCD8"},komornik:{label:"Komornik",color:"bg-amber-600",icon:"⚖️"},e_licytacje:{label:"e-Licytacje",color:"bg-emerald-600",icon:"\uD83D\uDD28"},elicytacje:{label:"e-Licytacje",color:"bg-emerald-600",icon:"\uD83D\uDD28"},olx:{label:"OLX",color:"bg-green-600",icon:"\uD83D\uDFE2"},otodom:{label:"Otodom",color:"bg-orange-600",icon:"\uD83C\uDFE0"},gratka:{label:"Gratka",color:"bg-rose-600",icon:"\uD83D\uDCCB"}};function o(e){var t;return null!==(t=i[e])&&void 0!==t?t:{label:e,color:"bg-gray-600",icon:"\uD83D\uDCCB"}}function c(e){let{auctionDate:t,className:r=""}=e,[l,s]=(0,n.useState)(""),[i,o]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>{let e=new Date(t).getTime();if(Number.isNaN(e)){s("—"),o(!1);return}let r=e-Date.now();if(r<=0){s("Zakończona"),o(!1);return}let a=Math.floor(r/864e5),n=[];a>0&&n.push("".concat(a," d")),n.push("".concat(Math.floor(r%864e5/36e5)," g")),n.push("".concat(Math.floor(r%36e5/6e4)," min")),s(n.join(" ")),o(r<864e5)};e();let r=setInterval(e,6e4);return()=>clearInterval(r)},[t]),(0,a.jsx)("span",{className:i?"font-medium text-red-600 ".concat(r):"text-neutral-600 ".concat(r),children:l})}function u(e){let t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("pl-PL")}function d(e){var t,r,i;let{listing:d,onStatusChange:m}=e,x=function(){let[e,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>t(!0),[]),e}(),p=o(d.source),h=null===(t=d.images)||void 0===t?void 0:t[0],g=null===(r=d.description)||void 0===r?void 0:r.trim(),b=(g&&"undefined"!==g&&"null"!==g?g.slice(0,120)+(g.length>120?"…":""):null)||"—";return(0,a.jsxs)("article",{className:"rounded-xl border border-neutral-200 bg-white shadow-sm overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 p-3 border-b border-neutral-100",children:[(0,a.jsxs)("span",{className:"inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium text-white ".concat(p.color),children:[(0,a.jsx)("span",{children:p.icon}),p.label]}),x&&function(e){if(null==e)return!1;let t=new Date(e);if(Number.isNaN(t.getTime()))return!1;let r=new Date;return t.getDate()===r.getDate()&&t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()}(d.created_at)&&(0,a.jsx)("span",{className:"rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:"NOWE (dzisiaj)"})]}),h&&(0,a.jsx)("div",{className:"relative aspect-video w-full bg-neutral-100",children:(0,a.jsx)(l.default,{src:h,alt:"",fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 33vw"})}),(0,a.jsxs)("div",{className:"p-4 flex flex-col flex-1",children:[(0,a.jsx)("h2",{className:"font-semibold text-neutral-900 line-clamp-2 mb-1",children:(0,a.jsx)("a",{href:d.source_url,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:d.title||"Bez tytułu"})}),(0,a.jsx)("p",{className:"text-lg font-medium text-neutral-800 mb-1",children:null==(i=d.price_pln)?"Cena do ustalenia":String(Math.floor(i/100)).replace(/\B(?=(\d{3})+(?!\d))/g," ")+" zł"}),(0,a.jsx)("p",{className:"text-sm text-neutral-500 mb-2",children:[d.location,d.city].filter(Boolean).join(", ")||"—"}),(()=>{var e;let t=d.auction_date&&""!==String(d.auction_date).trim()?d.auction_date:null!==(e=d.created_at)&&void 0!==e?e:"",r=d.auction_date&&""!==String(d.auction_date).trim()&&!Number.isNaN(new Date(d.auction_date).getTime());return x?(0,a.jsx)("p",{className:"text-sm mb-2",children:r?(0,a.jsxs)(a.Fragment,{children:["Licytacja:"," ",(0,a.jsx)(c,{auctionDate:d.auction_date}),(0,a.jsxs)("span",{className:"text-neutral-400 ml-1",children:["(",u(t),")"]})]}):(0,a.jsxs)("span",{className:"text-neutral-500",children:["Dodano: ",u(t)]})}):(0,a.jsx)("p",{className:"text-sm mb-2 text-neutral-500",children:r?(0,a.jsx)(a.Fragment,{children:"Licytacja: —"}):(0,a.jsxs)("span",{children:["Dodano: ",t||"—"]})})})(),(0,a.jsx)("p",{className:"text-sm text-neutral-600 line-clamp-2 mb-4",children:b}),(0,a.jsx)("div",{className:"mt-auto flex flex-wrap gap-2",children:s.map(e=>{var t;let{value:r,label:n}=e;return(0,a.jsx)("button",{type:"button",onClick:()=>m(d.id,r),className:"rounded-lg px-3 py-1.5 text-sm font-medium transition-colors ".concat((null!==(t=d.status)&&void 0!==t?t:"new")===r?"bg-neutral-900 text-white":"bg-neutral-100 text-neutral-700 hover:bg-neutral-200"),children:n},r)})})]})]})}function m(e){let{filters:t,onFiltersChange:r,sources:n,cities:l,priceRange:i}=e,c=e=>{r({...t,...e})};return(0,a.jsxs)("div",{className:"rounded-xl border border-neutral-200 bg-white p-4 shadow-sm space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-neutral-900",children:"Filtry"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-600 mb-1",children:"Źr\xf3dło"}),(0,a.jsxs)("select",{value:t.source,onChange:e=>c({source:e.target.value}),className:"w-full rounded-lg border border-neutral-300 px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Wszystkie"}),n.map(e=>(0,a.jsx)("option",{value:e,children:o(e).label},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-600 mb-1",children:"Status"}),(0,a.jsxs)("select",{value:t.status,onChange:e=>c({status:e.target.value}),className:"w-full rounded-lg border border-neutral-300 px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Wszystkie"}),s.map(e=>{let{value:t,label:r}=e;return(0,a.jsx)("option",{value:t,children:r},t)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-600 mb-1",children:"Miasto"}),(0,a.jsxs)("select",{value:t.city,onChange:e=>c({city:e.target.value}),className:"w-full rounded-lg border border-neutral-300 px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Wszystkie"}),l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-neutral-600 mb-1",children:["Cena (PLN): ",t.priceMin/100," – ",t.priceMax/100]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("input",{type:"range",min:i.min,max:i.max,step:1e4,value:t.priceMin,onChange:e=>c({priceMin:Number(e.target.value),priceMax:Math.max(Number(e.target.value),t.priceMax)}),className:"flex-1"}),(0,a.jsx)("input",{type:"range",min:i.min,max:i.max,step:1e4,value:t.priceMax,onChange:e=>c({priceMax:Number(e.target.value),priceMin:Math.min(Number(e.target.value),t.priceMin)}),className:"flex-1"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-600 mb-1",children:"Sortowanie po cenie"}),(0,a.jsxs)("select",{value:t.sortByPrice,onChange:e=>c({sortByPrice:e.target.value}),className:"w-full rounded-lg border border-neutral-300 px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Domyślne (data)"}),(0,a.jsx)("option",{value:"asc",children:"Cena: rosnąco"}),(0,a.jsx)("option",{value:"desc",children:"Cena: malejąco"})]})]})]})}let x={source:"",status:"",city:"",priceMin:0,priceMax:5e7,sortByPrice:""};function p(e){let{initialListings:t,priceRange:r}=e,[l,s]=(0,n.useState)({...x,priceMin:r.min,priceMax:r.max}),[i,o]=(0,n.useState)(t),c=(0,n.useMemo)(()=>Array.from(new Set(i.map(e=>e.source).filter(Boolean))).sort(),[i]),u=(0,n.useMemo)(()=>Array.from(new Set(i.map(e=>e.city).filter(e=>!!e))).sort(),[i]),p=(0,n.useMemo)(()=>{let e=i.filter(e=>{var t,r;if(l.source&&e.source!==l.source)return!1;let a=null!==(t=e.status)&&void 0!==t?t:"new";if(l.status&&a!==l.status||l.city&&e.city!==l.city)return!1;let n=null!==(r=e.price_pln)&&void 0!==r?r:0;return!(n<l.priceMin)&&!(n>l.priceMax)});return"asc"===l.sortByPrice?e=[...e].sort((e,t)=>{var r,a;return(null!==(r=e.price_pln)&&void 0!==r?r:0)-(null!==(a=t.price_pln)&&void 0!==a?a:0)}):"desc"===l.sortByPrice&&(e=[...e].sort((e,t)=>{var r,a;return(null!==(r=t.price_pln)&&void 0!==r?r:0)-(null!==(a=e.price_pln)&&void 0!==a?a:0)})),e},[i,l]),h=(0,n.useCallback)(async(e,t)=>{(await fetch("/api/listings/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})})).ok&&o(r=>r.map(r=>r.id===e?{...r,status:t}:r))},[]);return(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-6",children:[(0,a.jsx)("aside",{className:"lg:sticky lg:top-4 lg:self-start",children:(0,a.jsx)(m,{filters:l,onFiltersChange:s,sources:c,cities:u,priceRange:r})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-neutral-500 mb-4",children:["Pokazano ",(0,a.jsx)("strong",{children:p.length})," z"," ",(0,a.jsx)("strong",{children:i.length})," ofert"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:p.map(e=>(0,a.jsx)(d,{listing:e,onStatusChange:h},e.id))}),0===p.length&&(0,a.jsx)("p",{className:"text-center text-neutral-500 py-12",children:"Brak ofert spełniających kryteria."})]})]})}},3170:function(e,t,r){"use strict";r.r(t),r.d(t,{RefreshScrapersButton:function(){return s}});var a=r(7437),n=r(2265),l=r(9376);function s(){let e=(0,l.useRouter)(),[t,r]=(0,n.useState)(!1),[s,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),u=async()=>{r(!0),i(null);try{var t,a,n;let r=o?{days_back:1}:{limit:20},l=await fetch("/api/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await l.json().catch(()=>({}));if(!l.ok){let e=500===l.status?"Server error (500). Check Vercel env: BACKEND_URL, HUNTER_RUN_SECRET; or Railway backend logs.":409===l.status?"A run is already in progress. Try again in a few minutes.":"Error ".concat(l.status);i({type:"error",text:null!==(n=null!==(a=s.error)&&void 0!==a?a:s.message)&&void 0!==n?n:e});return}if(202===l.status){i({type:"ok",text:s.message||"Run started in background. The page will refresh in 60s to show new listings."}),setTimeout(()=>e.refresh(),6e4);return}if(!1===s.configured&&s.message){i({type:"ok",text:s.message});return}i({type:"ok",text:(null===(t=s.results)||void 0===t?void 0:t.length)?"Zaktualizowano: ".concat(s.results.map(e=>"".concat(e.source," (").concat(e.listings_upserted,")")).join(", ")):"Scrapery zakończone."}),e.refresh()}catch(e){i({type:"error",text:e instanceof Error?e.message:"Błąd połączenia"})}finally{r(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-neutral-600",children:[(0,a.jsx)("input",{type:"checkbox",checked:o,onChange:e=>c(e.target.checked),disabled:t,className:"rounded border-neutral-300"}),"Test run (yesterday only)"]}),(0,a.jsx)("button",{type:"button",onClick:u,disabled:t,className:"inline-flex items-center gap-2 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm font-medium text-neutral-700 shadow-sm hover:bg-neutral-50 disabled:opacity-50","aria-label":o?"Run scrapers for yesterday only":"Run scrapers (refresh listings)",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"size-4 animate-spin rounded-full border-2 border-neutral-300 border-t-neutral-600"}),"Uruchamiam…"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"size-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Odśwież oferty"]})}),s&&(0,a.jsx)("p",{className:"text-xs ".concat("ok"===s.type?"text-green-600":"text-red-600"),role:"status",children:s.text})]})}}},function(e){e.O(0,[406,971,117,744],function(){return e(e.s=8383)}),_N_E=e.O()}]);